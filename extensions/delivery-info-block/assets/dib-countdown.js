/* eslint-disable no-empty */
(()=>{if(window.__DIB_COUNTDOWN_INIT__)return;window.__DIB_COUNTDOWN_INIT__=true;function parseHHMM(v){if(!v||typeof v!=="string")return null;const m=v.trim().match(/^([01]\d|2[0-3]):([0-5]\d)$/);if(!m)return null;return{hh:Number(m[1]),mm:Number(m[2])}}function parseOffsetMinutes(z){if(!z||typeof z!=="string")return null;const cleaned=z.trim().replace(":","");const m=cleaned.match(/^([+-])(\d{2})(\d{2})$/);if(!m)return null;const sign=m[1]==="-"?-1:1;return sign*(Number(m[2])*60+Number(m[3]))}function formatRemaining(ms){const totalMin=Math.floor(ms/60000);const hh=Math.floor(totalMin/60);const mm=totalMin%60;return String(hh).padStart(2,"0")+"h "+String(mm).padStart(2,"0")+"m"}function appendMarkdownBold(el,text){if(!text)return;if(!text.includes("**")){el.appendChild(document.createTextNode(text));return}const parts=text.split("**");parts.forEach((part,i)=>{if(!part)return;if(i%2===1){const strong=document.createElement("strong");strong.textContent=part;el.appendChild(strong)}else{el.appendChild(document.createTextNode(part))}})}function formatETADate(date){const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];return months[date.getMonth()]+" "+date.getDate()}function addDeliveryDays(startDate,numDays,noDeliveryDays,customHolidays,bankHolidayCountry){const noDeliverySet=noDeliveryDays||new Set(['sat','sun']);const weekdayNames=["sun","mon","tue","wed","thu","fri","sat"];let currentDate=new Date(startDate.getTime());let daysAdded=0;let maxAttempts=60;while(daysAdded<numDays&&maxAttempts>0){currentDate=new Date(currentDate.getTime()+86400000);const weekdayKey=weekdayNames[currentDate.getDay()];const isNoDeliveryDay=noDeliverySet.has(weekdayKey);const isHolidayDay=customHolidays||bankHolidayCountry?isHoliday(currentDate,customHolidays||new Set(),bankHolidayCountry||""):false;if(!isNoDeliveryDay&&!isHolidayDay){daysAdded++}maxAttempts--}return currentDate}function splitClosedDays(v){if(!v)return new Set();return new Set(String(v).split(",").map((s)=>s.trim().toLowerCase()).filter(Boolean))}function parseCustomHolidays(v){if(!v)return new Set();return new Set(String(v).split(",").map((s)=>s.trim()).filter(Boolean))}function getEasterSunday(year){const a=year%19;const b=Math.floor(year/100);const c=year%100;const d=Math.floor(b/4);const e=b%4;const f=Math.floor((b+8)/25);const g=Math.floor((b-f+1)/3);const h=(19*a+b-d-g+15)%30;const i=Math.floor(c/4);const k=c%4;const l=(32+2*e+2*i-h-k)%7;const m=Math.floor((a+11*h+22*l)/451);const month=Math.floor((h+l-7*m+114)/31)-1;const day=((h+l-7*m+114)%31)+1;return new Date(year,month,day)}function formatDateStr(date){const y=date.getFullYear();const m=String(date.getMonth()+1).padStart(2,'0');const d=String(date.getDate()).padStart(2,'0');return y+"-"+m+"-"+d}function addDaysToDate(date,days){const result=new Date(date);result.setDate(result.getDate()+days);return result}function getNthWeekdayOfMonth(year,month,weekday,n){if(n>0){const firstDay=new Date(year,month,1);let firstWeekday=firstDay.getDay();let daysUntilWeekday=(weekday-firstWeekday+7)%7;const day=1+daysUntilWeekday+(n-1)*7;return new Date(year,month,day)}else{const lastDay=new Date(year,month+1,0);let lastWeekday=lastDay.getDay();let daysBackToWeekday=(lastWeekday-weekday+7)%7;const day=lastDay.getDate()-daysBackToWeekday+(n+1)*7;return new Date(year,month,day)}}const BANK_HOLIDAYS={GB:(year)=>{const easter=getEasterSunday(year);const earlyMay=getNthWeekdayOfMonth(year,4,1,1);const springBank=getNthWeekdayOfMonth(year,4,1,-1);const summerBank=getNthWeekdayOfMonth(year,7,1,-1);return[year+"-01-01",formatDateStr(addDaysToDate(easter,-2)),formatDateStr(addDaysToDate(easter,1)),formatDateStr(earlyMay),formatDateStr(springBank),formatDateStr(summerBank),year+"-12-25",year+"-12-26"]},US:(year)=>{const mlkDay=getNthWeekdayOfMonth(year,0,1,3);const presidentsDay=getNthWeekdayOfMonth(year,1,1,3);const memorialDay=getNthWeekdayOfMonth(year,4,1,-1);const laborDay=getNthWeekdayOfMonth(year,8,1,1);const columbusDay=getNthWeekdayOfMonth(year,9,1,2);const thanksgiving=getNthWeekdayOfMonth(year,10,4,4);return[year+"-01-01",formatDateStr(mlkDay),formatDateStr(presidentsDay),formatDateStr(memorialDay),year+"-06-19",year+"-07-04",formatDateStr(laborDay),formatDateStr(columbusDay),year+"-11-11",formatDateStr(thanksgiving),year+"-12-25"]},DE:(year)=>{const easter=getEasterSunday(year);return[year+"-01-01",formatDateStr(addDaysToDate(easter,-2)),formatDateStr(addDaysToDate(easter,1)),year+"-05-01",formatDateStr(addDaysToDate(easter,39)),formatDateStr(addDaysToDate(easter,50)),year+"-10-03",year+"-12-25",year+"-12-26"]},FR:(year)=>{const easter=getEasterSunday(year);return[year+"-01-01",formatDateStr(addDaysToDate(easter,1)),year+"-05-01",year+"-05-08",formatDateStr(addDaysToDate(easter,39)),formatDateStr(addDaysToDate(easter,50)),year+"-07-14",year+"-08-15",year+"-11-01",year+"-11-11",year+"-12-25"]},IE:(year)=>{const easter=getEasterSunday(year);const mayBank=getNthWeekdayOfMonth(year,4,1,1);const juneBank=getNthWeekdayOfMonth(year,5,1,1);const augustBank=getNthWeekdayOfMonth(year,7,1,1);const octoberBank=getNthWeekdayOfMonth(year,9,1,-1);return[year+"-01-01",year+"-02-01",year+"-03-17",formatDateStr(addDaysToDate(easter,1)),formatDateStr(mayBank),formatDateStr(juneBank),formatDateStr(augustBank),formatDateStr(octoberBank),year+"-12-25",year+"-12-26"]},CA:(year)=>{const easter=getEasterSunday(year);const familyDay=getNthWeekdayOfMonth(year,1,1,3);let vicDay=new Date(year,4,24);while(vicDay.getDay()!==1)vicDay.setDate(vicDay.getDate()-1);const labourDay=getNthWeekdayOfMonth(year,8,1,1);const thanksgiving=getNthWeekdayOfMonth(year,9,1,2);return[year+"-01-01",formatDateStr(familyDay),formatDateStr(addDaysToDate(easter,-2)),formatDateStr(vicDay),year+"-07-01",formatDateStr(getNthWeekdayOfMonth(year,7,1,1)),formatDateStr(labourDay),formatDateStr(thanksgiving),year+"-11-11",year+"-12-25",year+"-12-26"]},AU:(year)=>{const easter=getEasterSunday(year);const queensBirthday=getNthWeekdayOfMonth(year,5,1,2);let ausDay=new Date(year,0,26);if(ausDay.getDay()===0)ausDay=new Date(year,0,27);else if(ausDay.getDay()===6)ausDay=new Date(year,0,28);return[year+"-01-01",formatDateStr(ausDay),formatDateStr(addDaysToDate(easter,-2)),formatDateStr(addDaysToDate(easter,1)),year+"-04-25",formatDateStr(queensBirthday),year+"-12-25",year+"-12-26"]}};function getBankHolidaysForYear(countryCode,year){const getter=BANK_HOLIDAYS[countryCode];if(!getter)return[];return getter(year)}function isHoliday(date,customHolidays,bankHolidayCountry){const dateStr=formatDateStr(date);if(customHolidays.has(dateStr))return true;if(bankHolidayCountry){const year=date.getFullYear();const bankHolidays=getBankHolidaysForYear(bankHolidayCountry,year);if(bankHolidays.includes(dateStr))return true}return false}function computeCutoffForToday(el,now){const offsetStr=el.getAttribute("data-shop-offset")||"";const offsetMin=parseOffsetMinutes(offsetStr);const cutoffDefault=el.getAttribute("data-cutoff")||"";const cutoffSat=el.getAttribute("data-cutoff-sat")||"";const cutoffSun=el.getAttribute("data-cutoff-sun")||"";let weekdayKey=null;let y,mo,d;if(offsetMin!=null){const shopNowMs=now.getTime()+offsetMin*60*1000;const shopNow=new Date(shopNowMs);const weekday=["sun","mon","tue","wed","thu","fri","sat"][shopNow.getUTCDay()];weekdayKey=weekday;y=shopNow.getUTCFullYear();mo=shopNow.getUTCMonth()+1;d=shopNow.getUTCDate()}if(!weekdayKey||!y||!mo||!d)return{ok:false};const closed=splitClosedDays(el.getAttribute("data-closed-days")||"");if(closed.has(weekdayKey))return{ok:false};const customHolidays=parseCustomHolidays(el.getAttribute("data-custom-holidays")||"");const bankHolidayCountry=el.getAttribute("data-bank-holiday-country")||"";const todayDate=new Date(y,mo-1,d);if(isHoliday(todayDate,customHolidays,bankHolidayCountry))return{ok:false};let cutoff=cutoffDefault;if(weekdayKey==="sat"&&cutoffSat.trim())cutoff=cutoffSat;if(weekdayKey==="sun"&&cutoffSun.trim())cutoff=cutoffSun;const hm=parseHHMM(cutoff);if(!hm)return{ok:false};const cutoffUtcMs=Date.UTC(y,mo-1,d,hm.hh,hm.mm,0)-offsetMin*60*1000;return{ok:true,cutoffUtcMs}}function calculateShippingDate(el,now){const{ok,cutoffUtcMs}=computeCutoffForToday(el,now);const closed=splitClosedDays(el.getAttribute("data-closed-days")||"");const customHolidays=parseCustomHolidays(el.getAttribute("data-custom-holidays")||"");const bankHolidayCountry=el.getAttribute("data-bank-holiday-country")||"";const leadTime=parseInt(el.getAttribute("data-lead-time")||"0",10);const weekdayNames=["sun","mon","tue","wed","thu","fri","sat"];let shippingDate;if(ok&&cutoffUtcMs-now.getTime()>0){const todayKey=weekdayNames[now.getDay()];if(!closed.has(todayKey)&&!isHoliday(now,customHolidays,bankHolidayCountry)){shippingDate=now}else{shippingDate=new Date(now.getTime()+86400000)}}else{shippingDate=new Date(now.getTime()+86400000)}if(!shippingDate||(shippingDate.getTime()!==now.getTime())){let candidateDate=shippingDate||new Date(now.getTime()+86400000);let maxAttempts=14;while(maxAttempts>0){const weekdayKey=weekdayNames[candidateDate.getDay()];const isClosed=closed.has(weekdayKey);const isHolidayDay=isHoliday(candidateDate,customHolidays,bankHolidayCountry);if(!isClosed&&!isHolidayDay){shippingDate=candidateDate;break}candidateDate=new Date(candidateDate.getTime()+86400000);maxAttempts--}if(!shippingDate)shippingDate=new Date(now.getTime()+86400000)}if(leadTime>0){let daysAdded=0;let maxAttempts=60;while(daysAdded<leadTime&&maxAttempts>0){shippingDate=new Date(shippingDate.getTime()+86400000);const weekdayKey=weekdayNames[shippingDate.getDay()];if(!closed.has(weekdayKey)&&!isHoliday(shippingDate,customHolidays,bankHolidayCountry)){daysAdded++}maxAttempts--}}return shippingDate}function updateETATimeline(uid,shippingDate,orderDate){const etaTimeline=document.querySelector('.dib-eta-timeline[data-uid="'+uid+'"]');if(!etaTimeline)return;const orderDateEl=etaTimeline.querySelector('.dib-eta-stage:nth-child(1) .dib-eta-date');if(orderDateEl&&orderDate){orderDateEl.textContent=formatETADate(orderDate)}const shippingDateEl=etaTimeline.querySelector('.dib-eta-stage:nth-child(3) .dib-eta-date');if(shippingDateEl){shippingDateEl.textContent=formatETADate(shippingDate)}const courierNoDeliveryDaysStr=etaTimeline.getAttribute('data-courier-no-delivery')||'sat,sun';const courierNoDeliveryDays=splitClosedDays(courierNoDeliveryDaysStr);const customHolidays=parseCustomHolidays(etaTimeline.getAttribute("data-custom-holidays")||"");const bankHolidayCountry=etaTimeline.getAttribute("data-bank-holiday-country")||"";const deliveryMinDays=parseInt(etaTimeline.getAttribute('data-delivery-min')||'3');const deliveryMaxDays=parseInt(etaTimeline.getAttribute('data-delivery-max')||'5');const deliveryMinDate=addDeliveryDays(shippingDate,deliveryMinDays,courierNoDeliveryDays,customHolidays,bankHolidayCountry);const deliveryMaxDate=addDeliveryDays(shippingDate,deliveryMaxDays,courierNoDeliveryDays,customHolidays,bankHolidayCountry);const deliveryStageEl=etaTimeline.querySelector('.dib-eta-stage:nth-child(5)');const deliveryDateEl=deliveryStageEl?deliveryStageEl.querySelector('.dib-eta-date'):null;if(deliveryDateEl){if(deliveryMinDays===deliveryMaxDays){deliveryDateEl.textContent=formatETADate(deliveryMinDate);if(deliveryStageEl)deliveryStageEl.style.marginRight=''}else{const minMonth=deliveryMinDate.getMonth();const maxMonth=deliveryMaxDate.getMonth();if(minMonth===maxMonth){deliveryDateEl.textContent=formatETADate(deliveryMinDate)+"-"+deliveryMaxDate.getDate();if(deliveryStageEl)deliveryStageEl.style.marginRight=''}else{deliveryDateEl.textContent=formatETADate(deliveryMinDate)+"-"+formatETADate(deliveryMaxDate);if(deliveryStageEl){deliveryStageEl.style.marginRight='8px'}}}}}function updateCountdownPlaceholders(){document.querySelectorAll(".dib-countdown-placeholder").forEach(function(span){const line=span.closest(".dib-line");if(!line)return;const block=span.closest("[data-delivery-min]");if(!block)return;const cfgEl=block.querySelector(".dib-config");if(!cfgEl)return;const now=new Date();const{ok,cutoffUtcMs}=computeCutoffForToday(cfgEl,now);if(!ok||cutoffUtcMs-now.getTime()<=0){line.classList.remove("is-ready");return}const remainingMs=cutoffUtcMs-now.getTime();const timeStr=formatRemaining(remainingMs);span.textContent=timeStr;line.classList.add("is-ready")})}function updateETATimelinesStandalone(){const timelines=document.querySelectorAll(".dib-eta-timeline");timelines.forEach((timeline)=>{const uid=timeline.getAttribute('data-uid');if(!uid)return;const block=document.getElementById(uid);if(!block)return;const dummyEl=document.createElement("div");dummyEl.setAttribute("data-uid",uid);dummyEl.setAttribute("data-shop-offset",timeline.getAttribute("data-shop-offset")||"");dummyEl.setAttribute("data-cutoff",timeline.getAttribute("data-cutoff")||"14:00");dummyEl.setAttribute("data-cutoff-sat",timeline.getAttribute("data-cutoff-sat")||"");dummyEl.setAttribute("data-cutoff-sun",timeline.getAttribute("data-cutoff-sun")||"");dummyEl.setAttribute("data-closed-days",timeline.getAttribute("data-closed-days")||"");dummyEl.setAttribute("data-lead-time",timeline.getAttribute("data-lead-time")||"0");dummyEl.setAttribute("data-courier-no-delivery",timeline.getAttribute("data-courier-no-delivery")||"sat,sun");dummyEl.setAttribute("data-bank-holiday-country",timeline.getAttribute("data-bank-holiday-country")||"");dummyEl.setAttribute("data-custom-holidays",timeline.getAttribute("data-custom-holidays")||"");const now=new Date();const shippingDate=calculateShippingDate(dummyEl,now);updateETATimeline(uid,shippingDate,now)})}function updatePlaceholders(){document.querySelectorAll(".dib-arrival-placeholder, .dib-express-placeholder").forEach(function(span){var block=span.closest("[data-delivery-min]");if(!block)return;var cfgEl=block.querySelector(".dib-config");if(!cfgEl)return;var now=new Date();var shippingDate=calculateShippingDate(cfgEl,now);var courierStr=block.getAttribute("data-courier-no-delivery")||"sat,sun";var courierNoDelivery=splitClosedDays(courierStr);var customHolidays=parseCustomHolidays(cfgEl.getAttribute("data-custom-holidays")||"");var bankHolidayCountry=cfgEl.getAttribute("data-bank-holiday-country")||"";if(span.classList.contains("dib-arrival-placeholder")){var minDays=parseInt(block.getAttribute("data-delivery-min"))||3;var maxDays=parseInt(block.getAttribute("data-delivery-max"))||5;var minDate=addDeliveryDays(shippingDate,minDays,courierNoDelivery,customHolidays,bankHolidayCountry);var maxDate=addDeliveryDays(shippingDate,maxDays,courierNoDelivery,customHolidays,bankHolidayCountry);if(minDays===maxDays){span.textContent=formatETADate(minDate)}else if(minDate.getMonth()===maxDate.getMonth()){span.textContent=formatETADate(minDate)+"-"+maxDate.getDate()}else{span.textContent=formatETADate(minDate)+"-"+formatETADate(maxDate)}}else{var expressDate=addDeliveryDays(shippingDate,1,courierNoDelivery,customHolidays,bankHolidayCountry);span.textContent=formatETADate(expressDate)}})}function matchETAWidth(){document.querySelectorAll('[data-match-eta-width="true"]').forEach(function(block){var container=block.querySelector('.dib-container');if(!container)return;var timeline=document.querySelector('.dib-eta-timeline');if(!timeline)return;var wrapper=timeline.closest('.dib-eta-scale-wrapper');var targetWidth;if(wrapper){var tr=window.getComputedStyle(wrapper).transform;if(tr&&tr!=='none'){try{var mx=new DOMMatrix(tr);var scale=mx.a;var stages=timeline.querySelector('.dib-eta-stages');if(stages)targetWidth=stages.offsetWidth*scale}catch(e){}}}if(!targetWidth){var stages=timeline.querySelector('.dib-eta-stages');targetWidth=stages?stages.offsetWidth:timeline.offsetWidth}if(targetWidth>0){container.style.width=targetWidth+'px';container.style.maxWidth=targetWidth+'px'}})}function constrainETAGap(){document.querySelectorAll('.dib-eta-timeline-block').forEach(function(block){var stages=block.querySelector('.dib-eta-stages');if(!stages)return;var containerWidth=block.clientWidth;if(containerWidth<=0)return;var stageEls=stages.querySelectorAll('.dib-eta-stage');var connectorEls=[];stages.childNodes.forEach(function(child){if(child.nodeType===1&&!child.classList.contains('dib-eta-stage')){connectorEls.push(child)}});var stagesWidth=0;stageEls.forEach(function(el){stagesWidth+=el.offsetWidth});var connectorsWidth=0;connectorEls.forEach(function(el){connectorsWidth+=el.offsetWidth});var borderPadding=0;var cs=window.getComputedStyle(stages);var borderLeft=parseFloat(cs.borderLeftWidth)||0;var borderRight=parseFloat(cs.borderRightWidth)||0;var paddingLeft=parseFloat(cs.paddingLeft)||0;var paddingRight=parseFloat(cs.paddingRight)||0;borderPadding=borderLeft+borderRight+paddingLeft+paddingRight;var numGaps=stageEls.length+connectorEls.length-1;if(numGaps<=0)return;var availableForGaps=containerWidth-stagesWidth-connectorsWidth-borderPadding;var maxGapPerSlot=Math.max(0,availableForGaps/numGaps);var currentGap=parseFloat(cs.gap)||0;if(currentGap>maxGapPerSlot&&maxGapPerSlot>=0){stages.style.gap=Math.floor(maxGapPerSlot)+'px'}})}function tick(){document.querySelectorAll('[data-dib-js]:not([data-dib-init])').forEach(function(el){el.setAttribute('data-dib-init','1')});updateCountdownPlaceholders();updateETATimelinesStandalone();updatePlaceholders();constrainETAGap();matchETAWidth()}tick();setInterval(tick,30000);if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){setTimeout(function(){constrainETAGap();matchETAWidth()},50)})}else{setTimeout(function(){constrainETAGap();matchETAWidth()},50)}window.addEventListener('resize',function(){setTimeout(function(){constrainETAGap();matchETAWidth()},100)});window.DIBCountdown={computeCutoffForToday:computeCutoffForToday,formatRemaining:formatRemaining}})();
