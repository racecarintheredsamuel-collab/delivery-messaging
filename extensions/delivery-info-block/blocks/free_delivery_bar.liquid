{%- assign global_settings_json = shop.metafields.delivery_rules.settings.value -%}{%- assign global_settings = nil -%}{%- if global_settings_json != blank -%}{%- assign global_settings = global_settings_json | parse_json -%}{%- endif -%}{%- assign fd_enabled = false -%}{%- assign fd_threshold = 5000 -%}{%- capture fd_message_progress -%}Spend {remaining} more for free delivery{%- endcapture -%}{%- capture fd_message_unlocked -%}You've unlocked free delivery!{%- endcapture -%}{%- assign fd_message_empty = '' -%}{%- assign fd_show_progress_bar = true -%}{%- assign fd_progress_bar_color = '#22c55e' -%}{%- assign fd_progress_bar_bg = '#e5e7eb' -%}{%- assign fd_exclude_tags = '' -%}{%- assign fd_exclude_handles = '' -%}{%- assign fd_message_excluded = '' -%}{%- if global_settings != nil -%}{%- if global_settings.fd_enabled == true -%}{%- assign fd_enabled = true -%}{%- endif -%}{%- if global_settings.fd_threshold != blank -%}{%- assign fd_threshold = global_settings.fd_threshold -%}{%- endif -%}{%- if global_settings.fd_message_progress != blank -%}{%- assign fd_message_progress = global_settings.fd_message_progress -%}{%- endif -%}{%- if global_settings.fd_message_unlocked != blank -%}{%- assign fd_message_unlocked = global_settings.fd_message_unlocked -%}{%- endif -%}{%- if global_settings.fd_message_empty != blank -%}{%- assign fd_message_empty = global_settings.fd_message_empty -%}{%- endif -%}{%- if global_settings.fd_show_progress_bar == false -%}{%- assign fd_show_progress_bar = false -%}{%- endif -%}{%- if global_settings.fd_progress_bar_color != blank -%}{%- assign fd_progress_bar_color = global_settings.fd_progress_bar_color -%}{%- endif -%}{%- if global_settings.fd_progress_bar_bg != blank -%}{%- assign fd_progress_bar_bg = global_settings.fd_progress_bar_bg -%}{%- endif -%}{%- if global_settings.fd_exclude_tags != blank -%}{%- assign fd_exclude_tags = global_settings.fd_exclude_tags | json -%}{%- endif -%}{%- if global_settings.fd_exclude_handles != blank -%}{%- assign fd_exclude_handles = global_settings.fd_exclude_handles | json -%}{%- endif -%}{%- if global_settings.fd_message_excluded != blank -%}{%- assign fd_message_excluded = global_settings.fd_message_excluded -%}{%- endif -%}{%- if global_settings.fd_show_announcement_bar == true -%}{%- assign fd_show_announcement_bar = true -%}{%- else -%}{%- assign fd_show_announcement_bar = false -%}{%- endif -%}{%- assign fd_announcement_bg_color = global_settings.fd_announcement_bg_color | default: '#1f2937' -%}{%- assign fd_announcement_text_color = global_settings.fd_announcement_text_color | default: '#ffffff' -%}{%- assign fd_announcement_progress_message = global_settings.fd_announcement_progress_message | default: '' -%}{%- assign fd_announcement_unlocked_message = global_settings.fd_announcement_unlocked_message | default: '' -%}{%- assign fd_announcement_empty_message = global_settings.fd_announcement_empty_message | default: '' -%}{%- assign fd_announcement_excluded_message = global_settings.fd_announcement_excluded_message | default: '' -%}{%- assign fd_announcement_text_size = global_settings.fd_announcement_text_size | default: 'medium' -%}{%- assign fd_announcement_bar_height = global_settings.fd_announcement_bar_height | default: 'comfortable' -%}{%- endif -%}{%- assign ann_rendered_message = '' -%}{%- assign ann_initial_state = 'empty' -%}{%- if fd_show_announcement_bar -%}{%- assign cart_total = cart.total_price | default: 0 -%}{%- assign remaining_cents = fd_threshold | minus: cart_total -%}{%- if remaining_cents < 0 -%}{%- assign remaining_cents = 0 -%}{%- endif -%}{%- assign remaining_dollars = remaining_cents | divided_by: 100.0 -%}{%- assign threshold_dollars = fd_threshold | divided_by: 100.0 -%}{%- assign cart_total_dollars = cart_total | divided_by: 100.0 -%}{%- assign remaining_formatted = remaining_dollars | money -%}{%- assign threshold_formatted = threshold_dollars | money -%}{%- assign cart_total_formatted = cart_total_dollars | money -%}{%- if cart and cart.item_count > 0 -%}{%- if remaining_cents <= 0 -%}{%- assign ann_initial_state = 'unlocked' -%}{%- if fd_announcement_unlocked_message != blank -%}{%- assign ann_rendered_message = fd_announcement_unlocked_message | replace: '{remaining}', remaining_formatted | replace: '{threshold}', threshold_formatted | replace: '{cart_total}', cart_total_formatted -%}{%- else -%}{%- assign ann_rendered_message = fd_message_unlocked | replace: '{remaining}', remaining_formatted | replace: '{threshold}', threshold_formatted | replace: '{cart_total}', cart_total_formatted -%}{%- endif -%}{%- else -%}{%- assign ann_initial_state = 'progress' -%}{%- if fd_announcement_progress_message != blank -%}{%- assign ann_rendered_message = fd_announcement_progress_message | replace: '{remaining}', remaining_formatted | replace: '{threshold}', threshold_formatted | replace: '{cart_total}', cart_total_formatted -%}{%- else -%}{%- assign ann_rendered_message = fd_message_progress | replace: '{remaining}', remaining_formatted | replace: '{threshold}', threshold_formatted | replace: '{cart_total}', cart_total_formatted -%}{%- endif -%}{%- endif -%}{%- else -%}{%- if fd_announcement_empty_message != blank -%}{%- assign ann_initial_state = 'empty-message' -%}{%- assign ann_rendered_message = fd_announcement_empty_message | replace: '{remaining}', remaining_formatted | replace: '{threshold}', threshold_formatted | replace: '{cart_total}', cart_total_formatted -%}{%- endif -%}{%- endif -%}{%- endif -%}{%- if fd_enabled -%}
<div id="dib-fd-config" style="display:none" data-dm-config data-threshold="{{ fd_threshold }}" data-currency="{{ shop.currency }}" data-locale="{{ request.locale.iso_code | default: 'en-GB' }}" data-message-progress="{{ fd_message_progress | escape }}" data-message-unlocked="{{ fd_message_unlocked | escape }}" data-message-empty="{{ fd_message_empty | escape }}" data-show-progress-bar="{{ fd_show_progress_bar }}" data-progress-bar-color="{{ fd_progress_bar_color }}" data-progress-bar-bg="{{ fd_progress_bar_bg }}" data-exclude-tags="{{ fd_exclude_tags | escape }}" data-exclude-handles="{{ fd_exclude_handles | escape }}" data-message-excluded="{{ fd_message_excluded | escape }}"></div>
{%- if fd_show_announcement_bar -%}
{%- case fd_announcement_text_size -%}{%- when 'small' -%}{%- assign ann_font_size = '12px' -%}{%- when 'large' -%}{%- assign ann_font_size = '16px' -%}{%- else -%}{%- assign ann_font_size = '14px' -%}{%- endcase -%}
{%- case fd_announcement_bar_height -%}{%- when 'compact' -%}{%- assign ann_padding = '6px' -%}{%- assign ann_min_height = '32px' -%}{%- when 'standard' -%}{%- assign ann_padding = '8px' -%}{%- assign ann_min_height = '38px' -%}{%- when 'spacious' -%}{%- assign ann_padding = '14px' -%}{%- assign ann_min_height = '52px' -%}{%- else -%}{%- assign ann_padding = '10px' -%}{%- assign ann_min_height = '44px' -%}{%- endcase -%}
<div id="dib-fd-announcement" class="dib-fd-announcement" data-dm-target data-dm-state="{{ ann_initial_state }}" data-dm-type="announcement" data-progress-message="{{ fd_announcement_progress_message | escape }}" data-unlocked-message="{{ fd_announcement_unlocked_message | escape }}" data-empty-message="{{ fd_announcement_empty_message | escape }}" data-excluded-message="{{ fd_announcement_excluded_message | escape }}" style="--dib-ann-bg:{{ fd_announcement_bg_color }};--dib-ann-text:{{ fd_announcement_text_color }};--dib-ann-font-size:{{ ann_font_size }};--dib-ann-padding:{{ ann_padding }};--dib-ann-min-height:{{ ann_min_height }}">
  <div class="dib-fd-announcement-inner">
    <span data-dm-message>{{ ann_rendered_message }}</span>
    {%- if fd_show_progress_bar -%}<div class="dib-fd-announcement-progress" data-dm-progress data-fg="{{ fd_progress_bar_color }}" data-bg="{{ fd_progress_bar_bg }}"></div>{%- endif -%}
  </div>
</div>
{%- endif -%}
<style>.dib-fd-bar{display:flex;flex-direction:column;gap:8px;padding:12px 16px;background:#f9fafb;border-radius:8px;font-size:14px;line-height:1.4;z-index:10;transition:opacity .15s ease-out}.dib-fd-bar[data-dm-state="unlocked"]{background:#f0fdf4}.dib-fd-bar.dib-fd-celebrate{animation:dib-bounce .4s ease-out}.dib-fd-bar[data-dm-state="empty"]{opacity:0;pointer-events:none;transition:none;visibility:hidden}.dib-fd-message{text-align:center;font-weight:500;color:#374151}.dib-fd-bar[data-dm-state="unlocked"] .dib-fd-message{color:#15803d}.dib-fd-progress{display:block!important;width:100%;height:8px;border-radius:4px;transition:background .3s}@keyframes dib-bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}.dib-fd-announcement{position:fixed;top:0;left:0;right:0;z-index:99;background:var(--dib-ann-bg,#1f2937);color:var(--dib-ann-text,#fff);padding:var(--dib-ann-padding,10px) 16px;text-align:center;font-size:var(--dib-ann-font-size,14px);font-weight:500;min-height:var(--dib-ann-min-height,44px);box-sizing:border-box;transition:opacity .15s ease-out}.dib-fd-announcement[data-dm-state="hidden"],.dib-fd-announcement[data-dm-state="empty"]{opacity:0;pointer-events:none}.dib-fd-announcement-inner{display:flex;align-items:center;justify-content:center;gap:12px;max-width:600px;margin:0 auto}.dib-fd-announcement-progress{width:100px;height:6px;border-radius:3px;flex-shrink:0}body.dib-has-announcement{padding-top:44px}</style>
<script src="{{ 'dib-free-delivery.js' | asset_url }}" defer></script>
<script src="{{ 'delivery-messaging.js' | asset_url }}" defer></script>
{%- endif -%}
{% schema %}
{"name":"Free Delivery Bar","target":"body","javascript":"dib-free-delivery.js","settings":[]}
{% endschema %}
